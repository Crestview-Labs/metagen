# Ambient Mac App

Native macOS application for Ambient, providing a Claude-like chat interface with the Metagen backend.

## Prerequisites

### Required Dependencies

1. **Xcode** (14.0 or later)
   - Install from Mac App Store
   - Required for building Swift/macOS applications

2. **XcodeGen**
   - Install via Homebrew: `brew install xcodegen`
   - Generates Xcode project from `project.yml` specification
   - Automatically installed by build script if missing

3. **Homebrew** (for dependency management)
   - Install from https://brew.sh if not already installed

### Optional Dependencies

- **PyInstaller** (for bundling Python backend)
  - Installed automatically when building backend bundle
  - `pip install pyinstaller`

## Project Structure

```
macapp/
├── project.yml              # XcodeGen configuration
├── build.sh                 # Build script with dependency checks
├── Ambient/
│   ├── AmbientApp.swift    # Main app entry point
│   ├── Info.plist          # App metadata
│   ├── Models/             # View models and data models
│   ├── Services/           # Backend manager, API services
│   ├── Views/              # SwiftUI views
│   └── Resources/          # Assets and resources
└── Ambient.xcodeproj/      # Generated by XcodeGen (not in git)
```

## Building

### Quick Build

```bash
cd macapp
./build.sh
```

The build script will:
1. Check and install XcodeGen if needed
2. Generate the Xcode project from `project.yml`
3. Build the Swift API package
4. Build the Mac app in Release configuration
5. Optionally copy to /Applications

### Manual Build

1. Generate Xcode project:
   ```bash
   cd macapp
   xcodegen generate
   ```

2. Open in Xcode:
   ```bash
   open Ambient.xcodeproj
   ```

3. Build and run (Cmd+R) or archive for distribution

### Master Build Script

From the project root:
```bash
uv run python build.py --mac-app        # Build Mac app only
uv run python build.py --package-mac    # Build and package as DMG
uv run python build.py --all           # Build everything
```

## Development

### API Integration

The app uses the generated Swift API from `../api/swift`:
- Types are auto-generated from the backend's OpenAPI spec
- SSE streaming support for real-time chat
- Type-safe message handling

### Backend Integration

The app can run the backend in multiple ways:
1. **Bundled PyInstaller executable** (production)
2. **Local Python virtual environment** (development)
3. **Connect to existing backend** (if already running)

### Adding Dependencies

1. Swift packages: Add to `project.yml` under dependencies
2. System dependencies: Update `build.sh` with checks
3. Python dependencies: Update backend's `pyproject.toml`

## Troubleshooting

### XcodeGen Issues

If the project won't generate:
```bash
# Validate project.yml syntax
xcodegen dump --spec project.yml

# Force regenerate
rm -rf Ambient.xcodeproj
xcodegen generate
```

### Build Failures

1. Ensure Xcode command line tools are installed:
   ```bash
   xcode-select --install
   ```

2. Reset derived data:
   ```bash
   rm -rf ~/Library/Developer/Xcode/DerivedData
   ```

3. Check Swift API package builds:
   ```bash
   cd ../api/swift
   swift build
   ```

### Backend Connection Issues

Check if backend is running:
```bash
curl http://localhost:8985/health
```

Check logs in Console.app for backend startup errors.

## Release Process

1. Update version in `project.yml`
2. Build release version: `./build.sh`
3. Create DMG: `python ../build.py --package-mac`
4. Sign and notarize for distribution (requires Apple Developer account)

## License

See main project LICENSE file.